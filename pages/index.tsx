import { RepositoriesRequest } from 'classes/request/RepositoriesRequest'
import { BaseLayout } from 'components/layout/BaseLayout'
import type { InferGetServerSidePropsType, NextPage, NextPageContext } from 'next'
import Head from 'next/head'
import Image from 'next/image'
import { ItemRepository } from 'types/DataFromGitHubTypes'
import styles from '../styles/Home.module.css'

//NextPage

function Home ({ data }: InferGetServerSidePropsType<typeof getServerSideProps>) {
  return (
    <BaseLayout>
      <Head>
        <title>Inicio</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>
        <ul>
          {
            data && data?.map(repository=>(<li>{repository.name}</li>))
          }
        </ul>
      </div>
    </BaseLayout>
  )
}

export default Home


export async function getServerSideProps() {

  const requestRepositories = new RepositoriesRequest();

  const data: Array<ItemRepository> = [];

  try {
    const randomRepositories = await requestRepositories.getRepositoriesByNameTechnologyRandom();
    //console.log(randomRepositories);
    
    if(randomRepositories) {
      console.log('Hola');
      data.push(...randomRepositories);
    }
  } catch (error) {
    console.error(error);
  }

  console.log(data);
  

  return {
    props: {
      data
    }, // will be passed to the page component as props
  }
}
